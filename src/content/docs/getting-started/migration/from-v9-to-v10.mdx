import { StoryRenderer } from '@/components/ui/story-renderer';

## Migrating from 9.x to 10.x

Reablocks v10 introduces an **opt-in** approach to the new [Unify Design System](https://unifydesignsystem.com/#process) theme. **v9 remains the default** - existing projects continue to work without changes.

### Key Changes

#### Theme Variants (Opt-in)

v10 offers three theme variants:

1. **Default Theme** (v9-compatible) - No changes required
   - Uses semantic tokens (`bg-primary`, `text-text-secondary`)
   - Smaller bundle size (~145 KB / 19 KB gzipped)
   - Same API as v9

2. **Unify Theme** (Opt-in) - New design system
   - Uses component-specific tokens (`bg-buttons-colors-core-icon-primary-background-resting`)
   - Larger bundle size (~310 KB / 35 KB gzipped)
   - Requires explicit opt-in

3. **Custom Theme** (Opt-in) - Bring your own CSS
   - Use your own CSS file with custom design tokens
   - No Reablocks CSS in your bundle
   - Complete control over styling
   - Requires `variant="custom"` and your own CSS file

#### Minimal Changes for v9 Users

If you're using v9, upgrading to v10 requires a small change to the `ThemeProvider`:

**v9 (required theme prop):**
```tsx
import 'reablocks/index.css';
import { ThemeProvider, theme, Button } from 'reablocks';

function App() {
  return (
    <ThemeProvider theme={theme}>
      <Button>Click me</Button>
    </ThemeProvider>
  );
}
```

**v10 (theme prop is now optional):**
```tsx
import 'reablocks/index.css';
import { ThemeProvider, Button } from 'reablocks';

function App() {
  return (
    <ThemeProvider>
      <Button>Click me</Button>
    </ThemeProvider>
  );
}
```

**Backward Compatibility**: If you were passing `theme={theme}` in v9, you can simply remove it in v10. The default theme is now used automatically. However, if you don't update your code, it will still work - passing `theme={theme}` in v10 will merge the default theme with itself (redundant but harmless). If you were passing a custom theme object, that still works the same way - it will be merged with the base theme.

#### Opting into Unify Theme

To use the Unify theme, you need to:

1. Import the Unify CSS file:
```tsx
import 'reablocks/unify.css';  // Instead of 'reablocks/index.css'
```

2. Set the variant prop on ThemeProvider:
```tsx
<ThemeProvider variant="unify">
  <App />
</ThemeProvider>
```

### Migrating from Alpha (v10.0.0-alpha.x)

If you've been using the `unify-ds` branch alpha releases, please note key changes:

- CSS import changed from `index.css` to `unify.css`
- ThemeProvider now requires `variant="unify"` prop
- `theme` prop is now optional (for custom overrides only)

### Theme Variant Comparison

**CSS Bundle Size**
- **Default Theme**: Smaller (~145 KB / 19 KB gzipped in v10.0)
- **Unify Theme**: Larger (~310 KB / 35 KB gzipped in v10.0)
- **Custom Theme**: You control (your own CSS)

**Token Style**
- **Default Theme**: Semantic tokens (e.g., `bg-primary`)
- **Unify Theme**: Component-specific tokens (e.g., `bg-buttons-colors-core-icon-primary-background-resting`)
- **Custom Theme**: Your own design tokens

**Customization**
- **Default Theme**: Simple overrides
- **Unify Theme**: Granular control
- **Custom Theme**: Complete control

**Setup**
- **Default Theme**: Minimal (no configuration needed)
- **Unify Theme**: More configuration (requires `variant="unify"` and `unify.css` import)
- **Custom Theme**: Advanced (requires `variant="custom"`, your own CSS, and optional theme object)

**Recommendation**: Choose based on your needs and preferences:
- **Visual preference**: The themes have slightly different visual styles; compare them in [Storybook](https://storybook.reablocks.dev) to see which you prefer
- **Design system needs**: Use Unify for enterprise applications requiring granular design token control
- **Bundle size**: For marketing sites or lightweight apps where every KB matters, the default theme may be more appropriate (~16KB gzipped difference)

### Unify Compatibility Build

If you want Tailwind palette utilities (e.g., `gray-500`, `slate-700`) to use Unify's design tokens instead of Tailwind's default values, use the compatibility build:

```tsx
import 'reablocks/unify-compat.css';  // Instead of 'reablocks/unify.css'
import { ThemeProvider, Button } from 'reablocks';

function App() {
  return (
    <ThemeProvider variant="unify">
      <Button>Click me</Button>
    </ThemeProvider>
  );
}
```

**Key Difference**:
- **`unify.css`**: `text-gray-500` uses Tailwind's default gray (#6b7280)
- **`unify-compat.css`**: `text-gray-500` uses Unify's neutral token (matches your design system)

**Use this when**: You have existing code with palette utilities and want them to match your Unify design system colors. Otherwise, use the standard `unify.css` and migrate to semantic/component tokens over time.

### Custom Theme (Bring Your Own CSS)

For maximum customization, use the `custom` variant to provide your own CSS file with custom design tokens while using Reablocks components:

```tsx
import { ThemeProvider } from 'reablocks';
import './my-custom-tokens.css'; // Your own CSS with custom variables

function App() {
  return (
    <ThemeProvider variant="custom">
      <Button>Click me</Button>
    </ThemeProvider>
  );
}
```

**Best for:**
- Complete design system control
- Custom CSS variables and tokens
- Integration with existing design systems
- Advanced Tailwind customization

**How it works:**
- No Reablocks CSS is loaded (don't import `index.css` or `unify.css`)
- Uses default theme structure (Tailwind class names)
- Optionally provide a custom theme object via the `theme` prop
- Your CSS defines the design tokens/variables that the theme classes reference

> **Why use custom variant instead of theme overrides?** The `theme` prop on default/unify variants still uses Reablocks CSS files (~19-35 KB gzipped). Use `variant="custom"` when you want zero Reablocks CSS in your bundle, such as when integrating with an existing design system or implementing custom Tailwind configuration with your own design tokens.

### Light and Dark Mode

The default and Unify themes support light and dark modes out of the box. Toggle between modes by applying theme classes:

```tsx
// Toggle to dark mode
document.documentElement.classList.add('theme-dark');

// Toggle to light mode
document.documentElement.classList.remove('theme-dark');
document.documentElement.classList.add('theme-light');
```

Or using data attributes:
```tsx
document.documentElement.setAttribute('data-theme', 'dark');
document.documentElement.setAttribute('data-theme', 'light');
```

The ThemeProvider automatically observes these changes and updates component styling accordingly. Both the default and Unify themes include pre-configured light and dark color palettes.

**Note**: When using `variant="custom"`, you're responsible for implementing light/dark mode support in your own CSS by targeting the `.theme-dark`, `.theme-light`, `[data-theme="dark"]`, or `[data-theme="light"]` selectors. The ThemeProvider will still observe theme changes, but your CSS must define the color values for each mode.

### Custom Theme Overrides for Default and Unify Variants

The default and Unify variants support custom theme overrides. By default, custom themes are merged with the base theme:

```tsx
<ThemeProvider
  variant="default"  // or "unify"
  theme={{
    components: {
      button: {
        colors: {
          primary: {
            filled: 'bg-purple-600 hover:bg-purple-700'
          }
        }
      }
    }
  }}
>
  <App />
</ThemeProvider>
```

### Fully Replacing the Theme

To fully replace the base theme instead of merging, use the `replaceTheme` prop:

```tsx
import { ThemeProvider } from 'reablocks';
import { theme as myCompleteTheme } from './my-custom-theme';

<ThemeProvider theme={myCompleteTheme} replaceTheme>
  <App />
</ThemeProvider>
```

**When to use `replaceTheme`:**
- Building a completely custom theme from scratch
- Replacing the entire theme structure
- When you don't want any base theme properties

**When to use default merging:**
- Overriding specific component styles
- Extending the default or Unify theme
- Making targeted customizations

**Important notes:**
- When `replaceTheme={true}`, the `variant` prop is ignored since no base theme is loaded. You're replacing the theme object entirely, not selecting a variant.
- The `replaceTheme` prop affects the theme object (JavaScript/TypeScript), not the CSS file. Even with `replaceTheme={true}`, you still need to import a CSS file (either `index.css`, `unify.css`, or your own custom CSS).
- If you want both a custom theme object AND custom CSS with no Reablocks styles, use `variant="custom"` with `theme` prop (no need for `replaceTheme` since custom variant uses your theme as-is or merges with default structure).

### Important Notes

- **Set variant once**: The `variant` prop should be set at app initialization and not changed at runtime
- **Match CSS import**: Always import the CSS file that matches your variant
  - `variant="default"` → import `'reablocks/index.css'`
  - `variant="unify"` → import `'reablocks/unify.css'` or `'reablocks/unify-compat.css'`
  - `variant="custom"` → import your own CSS file (do not import any Reablocks CSS)
- **No runtime switching**: Changing variants at runtime requires loading both CSS files and may cause styling issues
- **Import only one CSS file**: Do not import both `index.css` and `unify.css` in the same application. The last import wins, which can cause unexpected styling and increased bundle size. Choose one based on your `variant` prop.

### Component Changes

#### Button component

* The `default`, `success`, `error` and `warning` color types have been removed.
* If you were using a Button without specifying a color, please add `color="primary"`.
* While these color options are no longer part of the interface, they remain available in the legacy theme if you're still using it.

#### Chip component
Introduced `type` component property with default `badge` value and `types` theme level to define separately styles for `badge` and `tag`. Selection and close functionality moved to `tag` type.

Badge:
<StoryRenderer path="components/ChipBadge.story.tsx" name="Colors"/>

Tag (Selectable):
<StoryRenderer path="components/ChipTag.story.tsx" name="Selectable"/>

Tag (Closable):
<StoryRenderer path="components/ChipTag.story.tsx" name="Closable"/>

#### Typography
`PageTitle`, `PrimaryHeading`, `SecondaryHeading`, `SmallHeading`, `Sub` and `Text` marked as deprecated.

Instead of these components introduced single `Typography` component with `variant` property to define typography type.

<StoryRenderer path="components/Typography.story.tsx" name="Label"/>

#### DeletableChip component

Marked as deprecated

### New Features

Alongside these changes, version 10.x also brings exciting new components:

#### Typography

A single, flexible Typography component (as described above).

#### Navigation component

Vertical layout:
<StoryRenderer path="components/Navigation.story.tsx" name="Text"/>

Horizontal layout:
<StoryRenderer path="components/Navigation.story.tsx" name="Horizontal"/>

### Token Mapping Guide

For detailed guidance on migrating from Default theme tokens to Unify tokens, including component-by-component mappings, see the [Default to Unify Token Mapping](/docs/getting-started/migration/default-to-unify-token-mapping) guide.

### That's it!

We hope these improvements make your experience with Reablocks even better. If you run into any issues, please let us know — we'd love to help.
